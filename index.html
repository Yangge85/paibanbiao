<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>排班表</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            overflow-x: hidden;
        }

        h1 {
            text-align: center;
            font-size: 1.4rem;
            margin: 20px 0;
        }

        .container {
            width: 95%;
            max-width: 950px;
            margin: 0 auto;
            padding: 0;
            box-sizing: border-box;
        }

        .date-container {
            text-align: right;
            margin-bottom: 20px;
        }

        label {
            font-size: 0.9rem;
        }

        input[type="date"] {
            font-size: 0.9rem;
        }

        .schedule {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8rem;
            table-layout: fixed;
        }

        .schedule th,
        .schedule td {
            border: 1px solid #ddd;
            padding: 4px;
            text-align: center;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            height: 20px;
        }

        .schedule th.date-col,
        .schedule td.date-col {
            width: 90px;
            font-size: 0.65rem;
        }

        .schedule td:nth-child(6) {
            width: 150px;
            font-size: 0.65rem;
        }

        .schedule th {
            background-color: #f4f4f4;
        }

        .weekend {
            color: red;
        }

        .schedule tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .badge-container {
            font-size: 0.35rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .badge-day,
        .badge-market {
            background-color: blue;
            color: white;
            padding: 1px 3px;
            width: 1rem;
            align-items: center;
        }

        .badge-market {
            background-color: red;
            align-items: center;
            width: 1rem;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.2rem;
            }

            label,
            input[type="date"],
            .schedule th,
            .schedule td {
                font-size: 0.6rem;
                padding: 3px;
            }

            .schedule th.date-col,
            .schedule td.date-col {
                width: 65px;
            }

            .schedule td:nth-child(6) {
                width: 120px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>前韩家庄驻村工作队排班表</h1>

        <div class="date-container">
            <label for="date">选择日期：</label>
            <input type="date" id="date" />
        </div>

        <table id="schedule" class="schedule">
            <thead>
                <tr>
                    <th class="date-col">日期</th>
                    <th>星期</th>
                    <th>主班</th>
                    <th>副班</th>
                    <th>副班</th>
                    <th>备注</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        const persons = [
            ['杜　阳', '左平周', '王勇伟'],
            ['王勇伟', '杜　阳', '左平周'],
            ['左平周', '王勇伟', '杜　阳']
        ];

        const weekDays = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
        const lunarMarketDays = { 河沿集: [2, 7, 12, 17, 22, 27], 北沼集: [4, 9, 14, 19, 24, 29] };

        // 2024和2025年各月的天数
        const lunarMonths = {
            2024: [29, 30, 29, 30, 29, 30, 29, 30, 29, 30, 29, 30], // 354天
            2025: [30, 29, 30, 29, 30, 29, 30, 28, 30, 30, 30, 30]  // 384天, 包含闰六月
        };

        const lunarYearStartDate = new Date(2024, 10, 1); // 2024年11月1日为农历十月初一

        function convertToLunarText(day) {
            if (day < 10) return '初' + '一二三四五六七八九'[day - 1];
            if (day < 20) return '十' + (day > 10 ? '一二三四五六七八九'[day - 11] : '');
            if (day < 30) return '廿' + (day > 20 ? '一二三四五六七八九'[day - 21] : '');
            return '三十';
        }

        function generateLunarDay(gregorianDate) {
            const year = gregorianDate.getFullYear();
            const totalDays = Math.floor((gregorianDate - lunarYearStartDate) / (24 * 60 * 60 * 1000));

            // 根据年份选择对应的农历月份
            const lunarDays = lunarMonths[year];
            let lunarDay = (totalDays % lunarDays.reduce((a, b) => a + b, 0)) + 1; // 计算农历天数

            // 计算月和天数
            let monthIndex = 0;
            let dayCount = lunarDays[monthIndex];

            while (lunarDay > dayCount) {
                lunarDay -= dayCount;
                monthIndex++;
                if (monthIndex >= lunarDays.length) break;
                dayCount = lunarDays[monthIndex];
            }

            return lunarDay; // 返回农历天数
        }

        function generateSchedule(startDate) {
            const tbody = document.querySelector('#schedule tbody');
            tbody.innerHTML = '';

            for (let i = 0; i < 7; i++) {
                const currentDate = new Date(startDate);
                currentDate.setDate(currentDate.getDate() + i);

                const lunarDay = generateLunarDay(currentDate);
                const dateStr = currentDate.toLocaleDateString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit' });
                const weekDay = weekDays[currentDate.getDay()];

                const isWeekend = currentDate.getDay() === 0 || currentDate.getDay() === 6;
                const dateClass = isWeekend ? 'weekend' : '';

                let badgeHTML = '';

                for (const [market, days] of Object.entries(lunarMarketDays)) {
                    if (days.includes(lunarDay)) {
                        badgeHTML = `
                            <div class="badge-container">
                                <div class="badge-day">${convertToLunarText(lunarDay)}</div>
                                <div class="badge-market">${market}</div>
                            </div>
                        `;
                    }
                }

                const rowHTML = `
                    <tr>
                        <td class="date-col ${dateClass}">${dateStr}</td>
                        <td class="${dateClass}">${weekDay}</td>
                        <td>${persons[(i % 3)][1]}</td>
                        <td>${persons[(i % 3)][2]}</td>
                        <td>${persons[(i % 3)][0]}</td>
                        <td class="note">${badgeHTML}</td>
                    </tr>
                `;

                tbody.innerHTML += rowHTML;
            }
        }

        window.onload = function () {
            const today = new Date();
            generateSchedule(today);
        };

        document.getElementById('date').addEventListener('change', function () {
            const selectedDate = new Date(this.value);
            generateSchedule(selectedDate);
        });
    </script>
</body>

</html>